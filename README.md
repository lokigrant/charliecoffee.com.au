# Charlie Coffee

[Jekyll](http://jekyllrb.com/) static site generator wrapped in a [Yeoman](http://yeoman.io/) development workflow, generated by [generator-jekyllrb](https://github.com/robwierzbowski/generator-jekyllrb).

Front end packages managed with [Bower](http://bower.io/) and build and deploy tasks with [Grunt](http://gruntjs.com/).

Uses [Sass](http://sass-lang.com/) as the CSS preprocessor with [Autoprefixer](https://github.com/ai/autoprefixer) for automatic vendor prefixing.

Built in development server with LiveReload.

Code quality checks with [Jshint](http://www.jshint.com/), [CssLint](http://csslint.net/), and `jekyll doctor`

Automatic build process that includes concatenation, image optimization, CSS and HTML minification, JS uglification, and asset revving for cache busting.


## Requirements

- [Node.js](http://nodejs.org/) `>= 0.10`
- [Ruby](http://www.ruby-lang.org/) `>= 1.9`
- [Bundler](http://gembundler.com/) gem
- [Yeoman](http://yeoman.io/) generator

## Getting Started

- Install node.js `brew install node`, `port install nodejs`, or install from package http://nodejs.org/#download
- Check installed version is >= 0.10 with `node -v`
- Install Yeoman as a global node.js package `npm install -g yo` - this also installs [Bower](http://bower.io/) and [Grunt](http://gruntjs.com/) and gives you cli tools `yo`, `bower` and `grunt`
- Make sure ruby is installed [rvm](http://rvm.io/rvm/install)
- Clone the repo and cd inside
- Run `npm install` to install local packages as defined in `package.json`. Packages are saved to `node_modules`, which is ignored in git
- Run `bower install` to install bower dependencies defined in `bower.json`. Packages are saved to `app/_bower_components`, which is ignored in git
- Start the development server `grunt serve`, which will open your browser at http://localhost:9002/ with LiveReload

The development server uses temp directories `.jekyll`, `.sass-cache` and `.tmp`.

The master branch contains the raw content and recipe for building the static site.

The grunt build task uses Jekyllrb to compile the site into the temporary dist folder and is then published into the gh-pages branch.

It uses a dist folder so that grunt can run multiple passes at concatenating, minifying, uglifying, optimising etc.

The dist folder is copied into the gh-pages branch by buildcontrol and is served by GitHub pages.
Source files in master and the jekyll generated site in the gh-pages branch.


## Grunt Workflow

#### grunt serve

Compiles all files and opens the site in your default browser. A watch task watches for changes to files, recompiles if necessary, and injects the changes into the browser with LiveReload.

#### grunt check

Checks code quality with Jshint and CSS Lint, and Jekyll health with `jekyll doctor`.

#### grunt build

Builds an optimized site to the dist directory. [Usemin blocks](https://github.com/yeoman/grunt-usemin#the-useminprepare-task) are concatenated, [CSS](https://github.com/gruntjs/grunt-contrib-cssmin), [images](https://github.com/gruntjs/grunt-contrib-imagemin), and [HTML](https://github.com/gruntjs/grunt-contrib-htmlmin) are minified, [JavaScript is uglified](https://github.com/gruntjs/grunt-contrib-uglify), and assets are [revved](https://github.com/yeoman/grunt-filerev) for cache busting.

`grunt serve:dist` will run `grunt build` and open the result in your default browser

#### grunt deploy

During scaffolding the generator gives you the option to configure [grunt-build-control](https://github.com/robwierzbowski/grunt-build-control) to version and deploy your built code to a remote repository. If you configure build-control, `grunt deploy` will run `grunt check`, `grunt test`, `grunt build`, and then commit and deploy your built code to the specified remote repository. 

#### grunt clean

Remove temporary folders used by the development server

#### grunt (default)

`grunt` on its own is a special task that runs `grunt check`, any tests you've added, and `grunt build`.

#### Individual tasks and :targets

Every task and target in the Gruntfile can be run individually (e.g., `grunt jshint:all` or `grunt compass:server`). Edit the tasks and [add new ones to fit your needs](http://gruntjs.com/configuring-tasks).


## Bower, components, and Usemin

[Bower](http://bower.io/) is a package manager for front-end components. Use it to download and manage CSS, JavaScript, and [preprocessor tools](https://github.com/Team-Sass) for your site. Everything in the _bower_components directory is available while running `grunt serve`.

To include components in the build, place them inside of a Usemin block or add them to the `copy:dist` task. This workflow will be streamlined with the release of Usemin 2.0.

## More on Yeoman and Grunt

[Getting started with Yeoman](http://yeoman.io/gettingstarted.html)
[Getting started with Grunt](http://gruntjs.com/getting-started)

## Notes

#### Nested asset directories and Jekyll

Jekyll [can't exclude nested directories](https://github.com/jekyll/jekyll/issues/906), so we must exclude all directories that match the innermost asset directory. For example, `assets/css` will exclude all directories named `css` from Jekyll compilation. This will cause issues if your site has a tag or category named `css`; if you're worried about accidental exclusions prefix all asset directories with an underscore (`assets/_css`).

#### Absolute path to assets in CSS

Since we revision assets such as images, make sure that your CSS calls them using their absolute path, so on ``grunt build`` those images will be replaced properly.

Incorrect:
```css
body {
  background: url('../images/foo.jpg');
}
```

Correct:
```css
body {
  background: url('/images/foo.jpg');
}
```

#### Yeoman Generator

This site was built by installing the Yeoman generator `npm install -g generator-jekyllrb` and running `yo jekyllrb` with the following options:

- Name: Charlie Coffee
- Email: info@charliecoffee.com.au
- CSS preprocessor: Sass
- Use Autoprefixer? Yes
- Javascript preprocessor: None
- CSS directory: css
- Javascript directory: js
- Image directory: img
- Webfont directory: fonts
- CSS preprocessor directory: _scss
- Site template: HTML5 Boilerplate
- Add H5BP CSS files? Yes
- Add H5BP javascript files? Yes
- Add H5BP favorite and touch icons? Yes
- Add H5BP documentation? No
- Include Google Analytics? Yes
- Use grunt-build-control for deployment? Yes
- Remote to deploy to: ../
- Branch to deploy to: gh-pages
- Site description: Charlie Coffee
- Post permalink style: date
- Markdown library: kramdown
- Use the Pygments code highlighting library? Yes
- Number of posts to show on the home page: all


## Resources

[generator-jekyllrb](https://github.com/robwierzbowski/generator-jekyllrb)
[jekyllrb.com](http://jekyllrb.com/)
